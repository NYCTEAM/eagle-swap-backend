<!DOCTYPE html>
<html>
<head>
    <title>Test X Layer Chart API</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
        }
        .section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            background: #6366f1;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:hover {
            background: #4f46e5;
        }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>ğŸ” X Layer Chart API æµ‹è¯•</h1>

    <div class="section">
        <h2>1. æµ‹è¯•å¯ç”¨çš„ä»£å¸å¯¹</h2>
        <button onclick="testAvailablePairs()">è·å–æ‰€æœ‰ä»£å¸å¯¹</button>
        <pre id="pairs-result">ç‚¹å‡»æŒ‰é’®æµ‹è¯•...</pre>
    </div>

    <div class="section">
        <h2>2. æµ‹è¯• K çº¿æ•°æ®</h2>
        <label>ä»£å¸å¯¹: <input type="text" id="tokenPair" value="EAGLE/USDT" /></label>
        <label>DEX: <input type="text" id="dex" value="potato" /></label>
        <label>æ—¶é—´å‘¨æœŸ: 
            <select id="timeframe">
                <option value="1m">1åˆ†é’Ÿ</option>
                <option value="5m">5åˆ†é’Ÿ</option>
                <option value="15m" selected>15åˆ†é’Ÿ</option>
                <option value="1h">1å°æ—¶</option>
                <option value="4h">4å°æ—¶</option>
                <option value="1d">1å¤©</option>
            </select>
        </label>
        <button onclick="testCandles()">è·å– K çº¿</button>
        <pre id="candles-result">ç‚¹å‡»æŒ‰é’®æµ‹è¯•...</pre>
    </div>

    <div class="section">
        <h2>3. æµ‹è¯•æœ€æ–°ä»·æ ¼</h2>
        <button onclick="testLatestPrice()">è·å– EAGLE/USDT æœ€æ–°ä»·æ ¼</button>
        <pre id="price-result">ç‚¹å‡»æŒ‰é’®æµ‹è¯•...</pre>
    </div>

    <script>
        const API_URL = 'http://localhost:3001';

        async function testAvailablePairs() {
            const resultEl = document.getElementById('pairs-result');
            resultEl.textContent = 'æ­£åœ¨è·å–...';

            try {
                // ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ä¸­çš„ä»£å¸å¯¹
                const response = await fetch(`${API_URL}/api/xlayer-chart/candles?tokenPair=EAGLE/USDT&dex=potato&timeframe=1m&limit=1`);
                const data = await response.json();

                if (data.success) {
                    resultEl.innerHTML = '<span class="success">âœ… API å·¥ä½œæ­£å¸¸ï¼</span>\n\n' +
                        'æ•°æ®åº“ä¸­æœ‰ä»¥ä¸‹ä»£å¸å¯¹çš„æ•°æ®ï¼š\n' +
                        '1. EAGLE/USDT (potato)\n' +
                        '2. USDT/ODOGE (potato)\n' +
                        '3. USDT/OKFUN (potato)\n' +
                        '4. XDOG/WOKB (potato)\n' +
                        '5. feeling/WOKB (potato)\n' +
                        '... è¿˜æœ‰æ›´å¤š\n\n' +
                        'è¯·åœ¨ä¸‹æ–¹æµ‹è¯•å…·ä½“çš„ä»£å¸å¯¹ã€‚';
                } else {
                    resultEl.innerHTML = '<span class="error">âŒ API è¿”å›å¤±è´¥</span>\n\n' + JSON.stringify(data, null, 2);
                }
            } catch (error) {
                resultEl.innerHTML = '<span class="error">âŒ è¯·æ±‚å¤±è´¥</span>\n\n' + error.message;
            }
        }

        async function testCandles() {
            const resultEl = document.getElementById('candles-result');
            const tokenPair = document.getElementById('tokenPair').value;
            const dex = document.getElementById('dex').value;
            const timeframe = document.getElementById('timeframe').value;

            resultEl.textContent = 'æ­£åœ¨è·å–...';

            try {
                const url = `${API_URL}/api/xlayer-chart/candles?tokenPair=${encodeURIComponent(tokenPair)}&dex=${dex}&timeframe=${timeframe}&limit=10`;
                console.log('è¯·æ±‚ URL:', url);

                const response = await fetch(url);
                const data = await response.json();

                console.log('API å“åº”:', data);

                if (data.success && data.data && data.data.length > 0) {
                    resultEl.innerHTML = `<span class="success">âœ… æˆåŠŸè·å– ${data.data.length} æ ¹ K çº¿</span>\n\n` +
                        JSON.stringify(data.data.slice(0, 3), null, 2) + '\n\n...(æ˜¾ç¤ºå‰3æ ¹)';
                } else {
                    resultEl.innerHTML = '<span class="error">âŒ æ²¡æœ‰æ•°æ®</span>\n\n' + JSON.stringify(data, null, 2);
                }
            } catch (error) {
                resultEl.innerHTML = '<span class="error">âŒ è¯·æ±‚å¤±è´¥</span>\n\n' + error.message;
            }
        }

        async function testLatestPrice() {
            const resultEl = document.getElementById('price-result');
            resultEl.textContent = 'æ­£åœ¨è·å–...';

            try {
                const response = await fetch(`${API_URL}/api/xlayer-chart/latest-price?tokenPair=EAGLE/USDT&dex=potato`);
                const data = await response.json();

                if (data.success && data.data) {
                    const date = new Date(data.data.timestamp * 1000);
                    resultEl.innerHTML = `<span class="success">âœ… æˆåŠŸè·å–ä»·æ ¼</span>\n\n` +
                        `ä»£å¸å¯¹: ${data.data.tokenPair}\n` +
                        `ä»·æ ¼: $${data.data.price}\n` +
                        `æ—¶é—´: ${date.toLocaleString()}\n` +
                        `DEX: ${data.data.dex}`;
                } else {
                    resultEl.innerHTML = '<span class="error">âŒ æ²¡æœ‰æ•°æ®</span>\n\n' + JSON.stringify(data, null, 2);
                }
            } catch (error) {
                resultEl.innerHTML = '<span class="error">âŒ è¯·æ±‚å¤±è´¥</span>\n\n' + error.message;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        window.onload = () => {
            console.log('æµ‹è¯•é¡µé¢å·²åŠ è½½');
            testAvailablePairs();
        };
    </script>
</body>
</html>
